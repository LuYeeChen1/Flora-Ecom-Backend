# FlowerShop Backend

**Repository Entry Â· Documentation Orchestrator**

æœ¬ä»“åº“æ˜¯ FlowerShop åç«¯é¡¹ç›®çš„**å”¯ä¸€æºç ä¸æ–‡æ¡£ä»“åº“**ï¼Œ
åŒæ—¶ä¹Ÿæ˜¯ **AI / Codex åä½œçš„å”¯ä¸€ä¸Šä¸‹æ–‡å…¥å£**ã€‚

README **ä¸æ‰¿è½½æ¶æ„ç»†èŠ‚**ï¼Œ
å®ƒçš„å”¯ä¸€èŒè´£æ˜¯ï¼š**ç¼–æ’ã€Œåº”è¯¥å…ˆè¯»å“ªäº› `.md` æ–‡ä»¶ï¼Œä»¥åŠå“ªäº›ä¸èƒ½ä¹±åŠ¨ã€**ã€‚

---

## ğŸ¯ æœ¬ä»“åº“è§£å†³ä»€ä¹ˆé—®é¢˜

FlowerShop æ˜¯ä¸€ä¸ªä»¥ **0 æˆæœ¬ / Free Tier** ä¸ºç¡¬çº¦æŸçš„ç”µå•†åç«¯é¡¹ç›®ï¼Œ
é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯ç»„åˆï¼š

* AWS Cognitoï¼ˆè®¤è¯ / æˆæƒï¼‰
* Serverlessï¼ˆLambda + API Gatewayï¼‰
* Spring Bootï¼ˆClean Architectureï¼‰
* æœ¬åœ° MySQLï¼ˆå¼€å‘ / æ¼”ç¤ºï¼‰

---

## âš ï¸ å¼ºåˆ¶è§„åˆ™ï¼ˆAI / Codex å¿…é¡»éµå®ˆï¼‰

* âŒ ç¦æ­¢å‡è®¾ä»»ä½•ã€Œæœªåœ¨æ–‡æ¡£ä¸­æ˜ç¡®å£°æ˜ä¸ºå·²å®Œæˆ / å·²å†»ç»“ã€çš„èƒ½åŠ›å·²ç»å­˜åœ¨
* âŒ ç¦æ­¢è·³è¿‡ README ç›´æ¥ç”Ÿæˆä»£ç 
* âŒ ç¦æ­¢åªçœ‹å•ä¸€æ–‡æ¡£ï¼ˆä¾‹å¦‚åªçœ‹ ARCHITECTURE.mdï¼‰

> **æ‰€æœ‰è¡Œä¸ºå¿…é¡»ä»¥æœ¬æ–‡æ¡£å®šä¹‰çš„é˜…è¯»é¡ºåºä¸ºå‡†ã€‚**

---

## ğŸ“š æ–‡æ¡£é˜…è¯»é¡ºåºï¼ˆå¼ºåˆ¶ï¼‰

### Step 0ï¼šä»“åº“å…¥å£ï¼ˆä½ æ­£åœ¨è¯»ï¼‰

* **README.mdï¼ˆæœ¬æ–‡ä»¶ï¼‰**

èŒè´£ï¼š

* å†³å®šã€Œè¯»ä»€ä¹ˆ / ä¸è¯»ä»€ä¹ˆ / å…ˆåé¡ºåºã€
* æ ‡æ³¨å“ªäº›æ–‡æ¡£æ˜¯ **æƒå¨å†»ç»“**
* æ ‡æ³¨å“ªäº›æ–‡æ¡£æ˜¯ **è¿‡ç¨‹ / å‚è€ƒ**

---

### Step 1ï¼šå…¨å±€æ¶æ„ä¸è¾¹ç•Œï¼ˆæœ€é«˜ä¼˜å…ˆçº§ Â· å†»ç»“ï¼‰

* **`docs/ARCHITECTURE.md`**

è¿™æ˜¯ **å…¨ä»“åº“å”¯ä¸€çš„æ¶æ„æƒå¨æ–‡æ¡£**ï¼Œå®šä¹‰äº†ï¼š

* Clean Architecture åˆ†å±‚
* ä¾èµ–æ–¹å‘
* Rule / Validation ä½“ç³»
* æŠ€æœ¯ä¸ä»£ç çº§ç¡¬çº¦æŸ

ğŸ“Œ **ä»»ä½•ä»£ç ã€è®¾è®¡ã€å®¡è®¡è¡Œä¸ºéƒ½ä¸å¾—è¿åæ­¤æ–‡ä»¶**ã€‚

> â— æœªå®Œæ•´é˜…è¯» `ARCHITECTURE.md` å³å¼€å§‹è¾“å‡ºä»£ç ï¼Œè§†ä¸ºä¸¥é‡è¿è§„ã€‚

---

### Step 2ï¼šé¡¹ç›®æ•´ä½“å®šä½ï¼ˆå†»ç»“ï¼‰

æœ¬èŠ‚æ•´åˆäº† `PROJECT_OVERVIEW` çš„å†…å®¹ï¼Œè¯´æ˜é¡¹ç›®å®šä½ä¸è¾¹ç•Œã€‚

* å¼€å‘ / æ¼”ç¤º / FYP
* 0 æˆæœ¬ï¼ˆFree Tierï¼‰
* å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼ˆREST APIï¼‰

#### æ ¸å¿ƒåŸåˆ™

* äº‘ç«¯èƒ½åŠ›ä¼˜å…ˆï¼ˆCognito / API Gateway / Lambda / S3ï¼‰
* Lambda åªåšâ€œäº‘ç«¯æƒé™åŠ¨ä½œâ€ï¼Œä¸åšä¸šåŠ¡
* ä¸šåŠ¡æ•°æ®å­˜æœ¬åœ° MySQL
* Seller / Admin ç­‰çŠ¶æ€ **åªç”± Cognito Group è¡¨è¾¾**

#### å½“å‰é˜¶æ®µ

* Seller Onboarding å°šæœªå†»ç»“
* æ¥ä¸‹æ¥ç”± Codex å®Œæˆ Frontend + Backend ä»£ç 
* æœ¬æ–‡æ¡£é›†æ˜¯ Cloud / æƒé™ / æµç¨‹çš„å”¯ä¸€äº‹å®æ¥æº

---

### Step 3ï¼šå½“å‰è¿›åº¦é”šç‚¹ï¼ˆåŠ¨æ€ï¼‰

æœ¬èŠ‚æ•´åˆäº† `CURRENT_PROGRESS` çš„å†…å®¹ï¼Œç”¨äºå‘Šè¯‰ä½ ã€Œç°åœ¨åšåˆ°å“ªã€ã€‚

#### å·²å®Œæˆ

* Cognito Groups å…¨éƒ¨åˆ›å»º
* ADMIN è´¦å·å·²æ‰‹åŠ¨åŠ å…¥ ADMIN group
* API Gateway + JWT Authorizer å·²é…ç½®
* Lambdaï¼š
  * move-to-seller-pending
  * approve-sellerï¼ˆå« Guardï¼‰
  * reject-sellerï¼ˆå« Guardï¼‰
* S3 Bucket å·²åˆ›å»ºï¼ˆç§æœ‰ + CORSï¼‰

#### æœªå†»ç»“

* Seller Onboardingï¼ˆç­‰å¾… Frontend + Backend å®Œæˆå¹¶ç«¯åˆ°ç«¯æµ‹è¯•ï¼‰

#### ä¸‹ä¸€æ­¥ï¼ˆç”± Codex å®Œæˆï¼‰

* Frontend Seller Submit (è¿™ä¸ªç”±frontend çš„ repository æ¥åšï¼Œbackendçš„ repositoryåªéœ€ä¸“æ³¨ backend)
* Backend Seller Onboarding Service
* Admin Review UI + Backend

---

### Step 4ï¼šCloud / Auth / Serverlessï¼ˆæŒ‰éœ€é˜…è¯»ï¼‰

å½“ä»»åŠ¡æ¶‰åŠ **äº‘ç«¯ã€è®¤è¯æˆ– Serverless** æ—¶ï¼Œé˜…è¯»ä»¥ä¸‹å†…å®¹ï¼š

#### Cloud Architecture

**ä½¿ç”¨çš„ AWS æœåŠ¡ï¼ˆå…¨éƒ¨åœ¨ Free Tier å†…ï¼‰**

* Amazon Cognitoï¼ˆè®¤è¯ + Groupï¼‰
* API Gateway HTTP APIï¼ˆREST APIï¼‰
* AWS Lambdaï¼ˆåªåš Cognito Group è¿ç§»ï¼‰
* Amazon S3ï¼ˆSeller ææ–™ä¸Šä¼ ï¼Œå¯é€‰ï¼‰
* CloudWatch Logsï¼ˆé»˜è®¤ï¼Œç”¨äºæ’é”™ï¼‰

**ä¸ä½¿ç”¨çš„æœåŠ¡ï¼ˆåˆ»æ„ä¸ç”¨ï¼‰**

* ä¸ä½¿ç”¨ DynamoDB / RDS
* ä¸ä½¿ç”¨ Step Functions
* ä¸ä½¿ç”¨ SES / SNS
* ä¸ä½¿ç”¨ OCR / AI / é£æ§ç±»æœåŠ¡

**æ€»ä½“ç»“æ„ï¼ˆé€»è¾‘ï¼‰**

Frontend
â†’ API Gateway (JWT Authorizer)
â†’ Lambdaï¼ˆæ”¹ Cognito Groupï¼‰
â†’ Backendï¼ˆSpring Boot / MySQLï¼‰

è¯´æ˜ï¼š

* Frontend åªé€šè¿‡ API Gateway è®¿é—® Lambda
* Backend ä¸ç›´æ¥æ“ä½œ Cognito Group
* Lambda æ°¸è¿œä¸è®¿é—® MySQL

#### Cognito & Authentication

**Cognito åŸºæœ¬è®¾ç½®**

* å•ä¸€ User Pool
* å•ä¸€ App Client
* Public Client + PKCE
* Hosted UI ç™»å½•
* ä½¿ç”¨ access_token ä½œä¸ºåç«¯é‰´æƒ token

**Cognito Groupsï¼ˆå†»ç»“ï¼‰**

ä¸šåŠ¡ç»„ï¼ˆåŒä¸€æ—¶é—´åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼‰

* CUSTOMER
* SELLER_PENDING
* SELLER
* SELLER_REJECTED

æƒé™ç»„ï¼ˆå¯å åŠ ï¼‰

* ADMIN

è§„åˆ™ï¼š

* ä¸šåŠ¡ç»„å¿…é¡»å•é€‰
* ADMIN å¯ä¸ä»»ä¸€ä¸šåŠ¡ç»„å…±å­˜
* ä¸ä½¿ç”¨ Group Precedence
* ä¸ä½¿ç”¨ custom attributes / role_stage

**Token ä½¿ç”¨çº¦å®š**

* Frontendï¼š
  * è°ƒ API æ—¶ç»Ÿä¸€ä½¿ç”¨ `Authorization: Bearer <access_token>`
* Backendï¼š
  * ç”¨ access_token æ ¡éªŒèº«ä»½
  * å¦‚éœ€è¦ emailï¼Œå¯é€šè¿‡ Cognito UserInfo è·å–å¹¶ç¼“å­˜

#### API Gateway & Lambda

**API Gateway**

* ç±»å‹ï¼šHTTP API
* é‰´æƒï¼šJWT Authorizerï¼ˆCognitoï¼‰
* æ‰€æœ‰å—ä¿æŠ¤æ¥å£éƒ½å¿…é¡»èµ° Authorizer

**Lambda è®¾è®¡åŸåˆ™**

* åªåš Cognito Group è¿ç§»
* ä¸è¯» / ä¸å†™ MySQL
* ä¸åšä¸šåŠ¡æ ¡éªŒ
* ä¸å¤„ç†æ–‡ä»¶
* ä¸ç”Ÿæˆ token

**å·²å­˜åœ¨çš„ Lambda API**

1. `POST /groups/move-to-seller-pending`
   * å½“å‰ç™»å½•ç”¨æˆ·è‡ªå·±
   * CUSTOMER â†’ SELLER_PENDING
2. `POST /groups/approve-seller`
   * ADMIN å®¡æ ¸åˆ«äºº
   * SELLER_PENDING â†’ SELLER
3. `POST /groups/reject-seller`
   * ADMIN å®¡æ ¸åˆ«äºº
   * SELLER_PENDING â†’ SELLER_REJECTED

**Lambda Guardï¼ˆå·²å®ç°ï¼‰**

* ä»… ADMIN å¯ approve / reject
* ADMIN ä¸å¯å®¡æ ¸è‡ªå·±
* åªèƒ½å®¡æ ¸ SELLER_PENDING
* ä¸šåŠ¡ç»„åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼ˆçŠ¶æ€æœºè‡ªæ£€ï¼‰

**Lambda IAM æƒé™ï¼ˆæœ€å°ï¼‰**

* cognito-idp:AdminAddUserToGroup
* cognito-idp:AdminRemoveUserFromGroup
* cognito-idp:AdminListGroupsForUser
* Resource é”å®šåˆ°å½“å‰ User Pool ARN

#### S3 Design (Optional)

**ç”¨é€”**

* Seller æä¾›è¯æ˜ææ–™ï¼ˆå›¾ç‰‡ / PDF ç­‰ï¼‰

**è®¾è®¡æ¨¡å¼**

* S3 + Pre-signed URL
* å‰ç«¯ç›´ä¼  S3
* Backend åªè´Ÿè´£ï¼š
  * å‘ presign URL
  * è®°å½• object key åˆ° MySQL

**å·²å®Œæˆ**

* ç§æœ‰ S3 Bucket å·²åˆ›å»º
* Block Public Access å…¨å¼€å¯
* Bucket Owner Enforced
* æœ€å° CORSï¼ˆlocalhostï¼‰

**å°šæœªå®Œæˆ**

* IAM Policyï¼ˆå‘ presign ç”¨ï¼‰
* presign æ¥å£è®¾è®¡ï¼ˆåªè®¾è®¡ï¼Œä¸å†™ Lambdaï¼‰

**æ˜ç¡®ä¸åš**

* ä¸åš OCR
* ä¸åšè‡ªåŠ¨å®¡æ ¸
* ä¸åš S3 äº‹ä»¶è§¦å‘

#### Seller Onboarding Flow

**æ€»ä½“æ¨¡å¼**

* ç³»ç»Ÿè‡ªåŠ¨åˆç­›ï¼ˆBackendï¼‰
* ADMIN äººå·¥ç»ˆå®¡ï¼ˆFrontend + Lambdaï¼‰

**Seller æäº¤æµç¨‹**

1. Seller å¡«å†™ä¸šåŠ¡èµ„æ–™ï¼ˆä¸åŒ…å« Cognito å·²æœ‰å­—æ®µï¼‰
2. Backend æ ¡éªŒå¹¶å†™ MySQLï¼š
   * status = PENDING_REVIEW
3. Backend è°ƒç”¨ï¼š
   * POST /groups/move-to-seller-pending
4. Cognitoï¼š
   * CUSTOMER â†’ SELLER_PENDING

**Admin å®¡æ ¸æµç¨‹**

1. Admin ç™»å½•ï¼ˆå¿…é¡»æœ‰ ADMIN groupï¼‰
2. Backend æŸ¥è¯¢ MySQL pending åˆ—è¡¨
3. Admin ç‚¹ approve / reject
4. Backendï¼š
   * æ›´æ–° MySQL çŠ¶æ€ + reason
   * è°ƒç”¨å¯¹åº” Lambda
5. Cognito Group è¿ç§»ï¼š
   * approve â†’ SELLER
   * reject  â†’ SELLER_REJECTED

**å…³é”®çº¦æŸ**

* Lambda ä¸çŸ¥é“ MySQL çš„å­˜åœ¨
* Backend ä¸ç›´æ¥æ”¹ Cognito Group

---

### Step 5ï¼šBackend åŠŸèƒ½ä¸çº¦å®šï¼ˆå‚è€ƒï¼‰

æœ¬èŠ‚æ•´åˆäº†å½“å‰åç«¯å·²å®ç°åŠŸèƒ½ä¸æ‰§è¡Œæ­¥éª¤ã€‚

#### 1. åº”ç”¨å¯åŠ¨ä¸åŸºç¡€ç»“æ„

**åŠŸèƒ½è¯´æ˜**ï¼šå¯åŠ¨ Spring Boot åº”ç”¨ï¼Œè£…é…å„å±‚ç»„ä»¶ï¼ˆæ¥å£å±‚ã€åº”ç”¨å±‚ã€åŸºç¡€è®¾æ–½å±‚ã€é¢†åŸŸå±‚ï¼‰ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. é€šè¿‡ `SpringApplication.run` å¯åŠ¨åº”ç”¨ã€‚
2. Spring Boot è‡ªåŠ¨æ‰«æå¹¶è£…é… `@Service`ã€`@Repository`ã€`@Component`ã€`@Configuration` ç­‰ç»„ä»¶ã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/FlowerShopApplication.java`

#### 2. è®¤è¯ä¸èµ„æºæœåŠ¡å™¨ï¼ˆCognito JWTï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š

* ä½œä¸º JWT Resource Server éªŒè¯ Cognito access tokenã€‚
* æ ¡éªŒ token ä½¿ç”¨åœºæ™¯ï¼ˆtoken_use=accessï¼‰å’Œ client_idã€‚
* ä»…å…è®¸ `/me` é€šè¿‡è®¤è¯è®¿é—®ï¼Œå…¶ä½™æ¥å£æ‹’ç»ã€‚
* æ”¯æŒ CORS é…ç½®ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. è¯»å–é…ç½®ï¼ˆissuerã€client_idã€jwk-set-uriã€CORS ç™½åå•ï¼‰ã€‚
2. æ„å»º `JwtDecoder` å¹¶åŠ è½½ä¸¤ç±»éªŒè¯å™¨ï¼šIssuer æ ¡éªŒ + access token/client_id æ ¡éªŒã€‚
3. SecurityFilterChain é…ç½®ï¼š
   * å…è®¸ `OPTIONS` é¢„æ£€ã€‚
   * `/me` éœ€è¦ç™»å½•ã€‚
   * å…¶ä»–æ¥å£æ‹’ç»ã€‚
4. é€šè¿‡ CORS é…ç½®å…è®¸æŒ‡å®šæ¥æºä¸æ–¹æ³•ã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/infrastructure/security/SecurityConfig.java`
* `src/main/java/com/backend/flowershop/infrastructure/security/AccessTokenValidator.java`
* `src/main/resources/application-dev.properties`

#### 3. å½“å‰ç”¨æˆ·èµ„æ–™æŸ¥è¯¢ï¼ˆ/meï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š

* æä¾› `GET /me` è¿”å›å½“å‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆsubjectã€usernameã€emailã€groupsï¼‰ã€‚
* ä» JWT ä¸­è§£æç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¡¥å……ç¼ºå¤±é‚®ç®±ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. Controller æ¥æ”¶ `GET /me`ï¼Œä» JWT ä¸­è§£æ subjectã€usernameã€emailã€groupsã€access tokenã€‚
2. è°ƒç”¨åº”ç”¨å±‚ç”¨ä¾‹ `CurrentUserProfileUseCase.fetch` è·å–ç”¨æˆ·èµ„æ–™ã€‚
3. åº”ç”¨å±‚æ£€æŸ¥æœ¬åœ°ç”¨æˆ·è¡¨ï¼š
   * è‹¥å·²æœ‰ emailï¼Œç›´æ¥è¿”å›ã€‚
   * è‹¥æ²¡æœ‰ emailï¼Œå°è¯•ä» Cognito UserInfo æ‹‰å–å¹¶ç¼“å­˜åˆ°æœ¬åœ°æ•°æ®åº“ã€‚
4. è¿”å› `UserProfileResponse` ç»™å‰ç«¯ã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/interfaces/controller/MeController.java`
* `src/main/java/com/backend/flowershop/application/service/CurrentUserProfileService.java`
* `src/main/java/com/backend/flowershop/application/port/usecase/CurrentUserProfileUseCase.java`
* `src/main/java/com/backend/flowershop/interfaces/controller/dto/UserProfileResponse.java`
* `src/main/java/com/backend/flowershop/domain/model/TokenClaims.java`
* `src/main/java/com/backend/flowershop/domain/model/UserProfile.java`

#### 4. UserInfo é‚®ç®±è¡¥å…¨ä¸ç¼“å­˜

**åŠŸèƒ½è¯´æ˜**ï¼š

* å½“ JWT ä¸­ä¸å« email æ—¶ï¼Œè°ƒç”¨ Cognito UserInfo API è·å– emailã€‚
* å°† email æŒä¹…åŒ–åˆ°æœ¬åœ° MySQL è¡¨ï¼ˆ`users`ï¼‰ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. `CurrentUserProfileService` å°è¯•ä»ç”¨æˆ·è¡¨è¯»å– emailã€‚
2. è‹¥æœªå‘½ä¸­ï¼š
   * ä½¿ç”¨ access token è°ƒç”¨ UserInfo APIã€‚
   * æ ¡éªŒ email éç©ºåå†™å…¥æœ¬åœ° `users` è¡¨ã€‚
3. è¿”å›è¡¥å…¨åçš„ emailã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/application/service/CurrentUserProfileService.java`
* `src/main/java/com/backend/flowershop/infrastructure/security/CognitoUserInfoClient.java`
* `src/main/java/com/backend/flowershop/application/port/security/UserInfoEmailPort.java`
* `src/main/java/com/backend/flowershop/infrastructure/persistence/JdbcUserAccountRepository.java`
* `src/main/java/com/backend/flowershop/domain/model/UserAccount.java`
* `src/main/resources/application.properties`
* `src/main/resources/application-dev.properties`

#### 5. ç»Ÿä¸€é¢†åŸŸé”™è¯¯è¾“å‡º

**åŠŸèƒ½è¯´æ˜**ï¼š

* æ•è·é¢†åŸŸå¼‚å¸¸å¹¶ç»Ÿä¸€è¿”å›é”™è¯¯ç»“æ„ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. é¢†åŸŸå±‚æŠ›å‡º `DomainErrorException`ã€‚
2. `DomainErrorHandler` æ•è·å¼‚å¸¸å¹¶è¿”å› `ErrorResponse`ã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/domain/error/DomainErrorException.java`
* `src/main/java/com/backend/flowershop/interfaces/controller/DomainErrorHandler.java`
* `src/main/java/com/backend/flowershop/interfaces/controller/dto/ErrorResponse.java`

#### 6. æœ¬åœ°æ•°æ®åº“å­˜å‚¨ï¼ˆç”¨æˆ·è¡¨ï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š

* ä½¿ç”¨ JDBC è®¿é—®æœ¬åœ° MySQL `users` è¡¨ã€‚
* æ”¯æŒæ ¹æ® subject æŸ¥è¯¢ä¸ upsert é‚®ç®±ã€‚

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. `JdbcUserAccountRepository` ä½¿ç”¨ SQL æŸ¥æ‰¾ `sub`ã€‚
2. ä½¿ç”¨ `INSERT ... ON DUPLICATE KEY UPDATE` è¿›è¡Œ upsertã€‚

**æ¶‰åŠæ–‡ä»¶**ï¼š

* `src/main/java/com/backend/flowershop/infrastructure/persistence/JdbcUserAccountRepository.java`
* `src/main/resources/application-dev.properties`

---

### Step 6ï¼šFrontendï¼ˆä»…åœ¨æ¶‰åŠå‰ç«¯æ—¶ï¼‰

#### Frontend Overview

**ä¸€å¥è¯æ€»ç»“**

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Vue 3 + Vite + Tailwind CSS** çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ï¼Œ  
é€šè¿‡ **Amazon Cognito OAuth2 Authorization Code + PKCE** å®Œæˆç™»å½•è®¤è¯ï¼Œ  
ç™»å½•åæä¾›å—ä¿æŠ¤çš„ `/app/*` åŒºåŸŸï¼Œå¹¶é€šè¿‡ `authFetch()` ç»Ÿä¸€å®Œæˆç™»å½•æ€ API è¯·æ±‚ã€‚

**æ ¸å¿ƒèƒ½åŠ›ï¼ˆKey Pointsï¼‰**

* OAuth2 + PKCEï¼ˆS256ï¼‰
* Cognito Hosted UIï¼ˆä¸è‡ªå»ºç™»å½•é¡µï¼‰
* sessionStorage ç®¡ç† OAuth ä¸´æ—¶æ•°æ® / token / userInfo
* Vue Router æ˜ç¡®åŒºåˆ†ç™»å½•å‰ / ç™»å½•å
* `authFetch()` ç»Ÿä¸€å¤„ç† tokenã€åˆ·æ–°ä¸ 401 é‡è¯•
* Tailwind CSS æä¾›ä¸€è‡´ UI

**å‰ç«¯èŒè´£è¾¹ç•Œ**

å‰ç«¯è´Ÿè´£ï¼š

* ç™»å½• / ç™»å‡ºè·³è½¬
* token è·å–ã€å­˜å‚¨ã€åˆ·æ–°
* è·¯ç”±åŒºåˆ†ä¸ UI æ§åˆ¶
* API è¯·æ±‚è‡ªåŠ¨æºå¸¦ token

å‰ç«¯ä¸è´Ÿè´£ï¼š

* ç”¨æˆ·æƒé™æœ€ç»ˆåˆ¤æ–­
* è§’è‰²/æƒé™ç®¡ç†é€»è¾‘
* æ•°æ®åˆæ³•æ€§æ ¡éªŒï¼ˆç”±åç«¯è´Ÿè´£ï¼‰

**å½“å‰å®ç°è¿›åº¦ï¼ˆæˆªè‡³ç›®å‰ï¼‰**

* âœ… è®¤è¯æµç¨‹ï¼šCognito OAuth2 + PKCE ç™»å½•/å›è°ƒ/ç™»å‡ºå…¨é“¾è·¯å·²å®ç°
* âœ… token ç”Ÿå‘½å‘¨æœŸï¼šè·å–ã€åˆ·æ–°ã€401 é‡è¯•ã€ç™»å‡ºæ¸…ç†å·²å®ç°
* âœ… è·¯ç”±ç»“æ„ï¼šç™»å½•/å›è°ƒ/ç™»å‡º/ç™»å½•ååŒºåŸŸè·¯ç”±å·²å®Œæˆ
* âœ… ç”¨æˆ·å±•ç¤ºï¼šuserInfo æ‹‰å– + JWT å…œåº•å±•ç¤ºå·²å®ç°
* âœ… ç¤ºä¾‹é¡µé¢ï¼š`/app/me` è°ƒç”¨å—ä¿æŠ¤æ¥å£å¹¶å±•ç¤ºç»“æœ
* âœ… æ–‡æ¡£æ˜ å°„ï¼šåŠŸèƒ½ â†’ æ–‡ä»¶æ˜ å°„ä¸éªŒè¯æ¸…å•å·²ç»´æŠ¤

#### Frontend Feature File Mapping

ï¼ˆåŠŸèƒ½ä¸æ–‡ä»¶ç»„åˆå¯¹åº”å…³ç³»ï½œæœ€ç»ˆä¸¥æ ¼ä¸€è‡´ç‰ˆï¼‰

> çº¦æŸè¯´æ˜  
> - æœ¬æ–‡æ¡£ **å¯¹é½å½“å‰ä»£ç **  
> - **åªåˆ—å‡ºçœŸå®å­˜åœ¨ä¸”è¢«ä½¿ç”¨çš„æ–‡ä»¶**  
> - æ¯ä¸€ä¸ªæ–‡ä»¶ **è‡³å°‘åœ¨ä¸€ä¸ªåŠŸèƒ½ç‚¹ä¸­å‡ºç°ä¸€æ¬¡**

##### ä¸€ã€åº”ç”¨å¯åŠ¨ä¸è·¯ç”±éª¨æ¶

**åŠŸèƒ½**  
åˆå§‹åŒ– Vue åº”ç”¨ã€æŒ‚è½½ Routerã€å¯ç”¨ Tailwind æ ·å¼ï¼›  
é€šè¿‡è·¯ç”±åˆ’åˆ†ç™»å½•åŒºã€å›è°ƒé¡µã€ç™»å‡ºé¡µä¸ç™»å½•åå—ä¿æŠ¤åŒºåŸŸã€‚

**æ–‡ä»¶ç»„åˆ**

* `index.html`  
  * SPA æŒ‚è½½å…¥å£
* `src/main.js`  
  * åˆ›å»º Vue App  
  * æŒ‚è½½ Router  
  * å¼•å…¥å…¨å±€æ ·å¼
* `src/style.css`  
  * Tailwind CSS å…¨å±€æ ·å¼å…¥å£
* `src/App.vue`  
  * é¡¶å±‚ç»„ä»¶ï¼Œä»…æ¸²æŸ“ `<router-view />`
* `src/router/index.js`  
  * å®šä¹‰è·¯ç”±ç»“æ„ï¼š`/`ã€`/callback`ã€`/signed-out`ã€`/app/*`
* `vite.config.js`  
  * Vite æ„å»ºé…ç½®
* `package.json`  
  * é¡¹ç›®ä¾èµ–ä¸è„šæœ¬ï¼ˆdev / build / previewï¼‰

##### äºŒã€Cognito ç™»å½•å…¥å£ï¼ˆOAuth2 + PKCEï¼‰

**åŠŸèƒ½**  
æœªç™»å½•ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®åï¼š  
ç”Ÿæˆ PKCE verifier / challenge ä¸ stateï¼Œ  
ä¿å­˜åˆ° sessionStorageï¼Œ  
è·³è½¬åˆ° Cognito Hosted UIã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/pages/Auth.vue`  
  * ç™»å½•å…¥å£é¡µé¢ UI  
  * è§¦å‘ç™»å½•æµç¨‹
* `src/auth/login/oauth.ts`  
  * ç”Ÿæˆ state  
  * è°ƒç”¨ PKCE å·¥å…·  
  * æ‹¼æ¥ Cognito authorize URL  
  * æ‰§è¡Œæµè§ˆå™¨è·³è½¬
* `src/auth/login/pkce.ts`  
  * ç”Ÿæˆ PKCE verifier  
  * ç”Ÿæˆ PKCE challengeï¼ˆSHA-256 + base64urlï¼‰
* `src/auth/storage/tempStorage.ts`  
  * ä¿å­˜ OAuth ä¸´æ—¶æ•°æ®ï¼ˆstate / verifierï¼‰
* `src/auth/config/cognito.ts`  
  * Cognito OAuth é…ç½®  
  * domain / client_id / redirect_uriï¼ˆæ¥è‡ª envï¼‰

##### ä¸‰ã€OAuth å›è°ƒå¤„ç†ï¼ˆæ¢ token + æ‹‰ userInfo + è·³è½¬ï¼‰

**åŠŸèƒ½**  
Cognito ç™»å½•å®Œæˆåå›è°ƒï¼š  
æ ¡éªŒ state â†’ æ¢ token â†’ ç¼“å­˜ token â†’ æ‹‰å– userInfo â†’ è·³è½¬åˆ° `/app/me`ã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/pages/Callback.vue`  
  * å›è°ƒé¡µé¢ UI  
  * æ˜¾ç¤ºåŠ è½½ / é”™è¯¯çŠ¶æ€  
  * è§¦å‘å›è°ƒå¤„ç†é€»è¾‘
* `src/auth/callback/handleCallback.ts`  
  * æ ¡éªŒ state  
  * ä½¿ç”¨æˆæƒç æ¢ token  
  * ä¿å­˜ token  
  * åè°ƒæ‹‰å– userInfo
* `src/auth/callback/tokenExchange.ts`  
  * authorization code â†’ token
* `src/auth/request/tokenTypes.ts`  
  * token å“åº”ç»“æ„ç±»å‹å®šä¹‰
* `src/auth/storage/tokenStorage.ts`  
  * ä¿å­˜ access_token / refresh_token / è·å–æ—¶é—´
* `src/auth/storage/userInfoStorage.ts`  
  * ç¼“å­˜ userInfo
* `src/auth/userInfo.ts`  
  * è¯·æ±‚ Cognito `/oauth2/userInfo`
* `src/auth/config/cognito.ts`  
  * token / userInfo ç«¯ç‚¹é…ç½®

##### å››ã€ç™»å½•æ€ API è¯·æ±‚ï¼ˆauthFetchï¼‰

**åŠŸèƒ½**  
ç»Ÿä¸€å°è£…ç™»å½•æ€ API è¯·æ±‚ï¼š  
è‡ªåŠ¨æºå¸¦ Bearer tokenã€  
åœ¨è¿‡æœŸå‰åˆ·æ–°ã€  
401 æ—¶è‡ªåŠ¨é‡è¯•ä¸€æ¬¡ã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/auth/request/authFetch.ts`  
  * æ ¸å¿ƒå°è£…é€»è¾‘  
  * token åˆ¤æ–­  
  * refresh è°ƒåº¦  
  * 401 é‡è¯•
* `src/auth/request/refreshToken.ts`  
  * refresh_token â†’ æ–° token
* `src/auth/request/tokenTypes.ts`  
  * token å“åº”ç±»å‹
* `src/auth/storage/tokenStorage.ts`  
  * è¯»å– / ä¿å­˜ token
* `src/auth/config/api.ts`  
  * API_BASEï¼Œç”¨äºæ‹¼æ¥è¯·æ±‚åœ°å€

##### äº”ã€å·²ç™»å½•åº”ç”¨å¸ƒå±€ + å¯¼èˆª + Logout

**åŠŸèƒ½**  
ç™»å½•åçš„åº”ç”¨åŒºåŸŸï¼š  
ç»Ÿä¸€å¸ƒå±€å£³ã€  
æ¡Œé¢ / ç§»åŠ¨ç«¯å¯¼èˆªã€  
å½“å‰ç”¨æˆ·ä¿¡æ¯å±•ç¤ºã€  
ç™»å‡ºå¹¶è·³è½¬ Cognito logoutã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/layouts/AppLayout.vue`  
  * ç™»å½•åé¡µé¢å£³  
  * Header + `<router-view />`
* `src/layouts/app/AppHeader.vue`  
  * æ¡Œé¢å¯¼èˆª  
  * Logout æŒ‰é’®  
  * ç§»åŠ¨ç«¯èœå•å…¥å£
* `src/layouts/app/AppMobileNav.vue`  
  * ç§»åŠ¨ç«¯å¯¼èˆªåˆ—è¡¨
* `src/layouts/app/nav.ts`  
  * å¯¼èˆªé¡¹é…ç½®ï¼ˆå½“å‰ä»… Meï¼‰
* `src/layouts/app/useAppLayout.ts`  
  * èšåˆé€»è¾‘ï¼š  
    * å½“å‰ç”¨æˆ·æ˜¾ç¤ºå  
    * userInfo æ‹‰å–åè°ƒ  
    * Logout è¡Œä¸ºå°è£…
* `src/auth/display/userLabel.ts`  
  * ä» userInfo / JWT ç”Ÿæˆå±•ç¤ºå
* `src/auth/userInfo.ts`  
  * Cognito userInfo è¯·æ±‚
* `src/auth/storage/userInfoStorage.ts`  
  * userInfo ç¼“å­˜
* `src/utils/jwt.ts`  
  * JWT payload è§£ç ï¼ˆUI å…œåº•ï¼‰
* `src/auth/config/cognito.ts`  
  * Cognito logout åŸŸåä¸ redirect é…ç½®
* `src/auth/storage/tokenStorage.ts`  
  * ç™»å‡ºæ—¶æ¸…ç† token

##### å…­ã€å—ä¿æŠ¤é¡µé¢ `/app/me`ï¼ˆç¤ºä¾‹ APIï¼‰

**åŠŸèƒ½**  
åœ¨ç™»å½•ååŒºåŸŸè°ƒç”¨åç«¯ `/me` æ¥å£ï¼Œ  
å±•ç¤ºè¿”å›ç»“æœæˆ–é”™è¯¯ä¿¡æ¯ã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/pages/Me.vue`  
  * é¡µé¢ UI ä¸ä¸šåŠ¡é€»è¾‘  
  * è°ƒç”¨ `authFetch("/me")`
* `src/auth/request/authFetch.ts`  
  * è‡ªåŠ¨æºå¸¦ / åˆ·æ–° token
* `src/auth/config/api.ts`  
  * API_BASE æ‹¼æ¥è¯·æ±‚åœ°å€
* `src/auth/storage/tokenStorage.ts`  
  * æä¾› tokenï¼ˆé—´æ¥å‚ä¸ï¼‰

##### ä¸ƒã€ç™»å‡ºå›è°ƒè½åœ°é¡µ

**åŠŸèƒ½**  
Cognito logout redirect åï¼š  
å±•ç¤ºâ€œå·²ç™»å‡ºâ€æç¤ºï¼Œ  
æä¾›å›ç™»å½•å…¥å£ã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/pages/SignedOut.vue`  
  * ç™»å‡ºå®Œæˆæç¤ºé¡µ UI

##### å…«ã€Auth æ¨¡å—èšåˆå…¥å£

**åŠŸèƒ½**  
Auth æ¨¡å—ç»Ÿä¸€å¯¼å‡ºå…¥å£ï¼ˆbarrel fileï¼‰ï¼Œ  
ç”¨äºé›†ä¸­å¯¼å‡º auth ç›¸å…³æ–¹æ³•ä¸é…ç½®ã€‚

**æ–‡ä»¶ç»„åˆ**

* `src/auth/index.ts`
* `src/auth/storage/index.ts`

---

### Step 7ï¼šAI / Codex å·¥ä½œè§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

æœ¬èŠ‚æ•´åˆäº† Codex Working Rulesã€‚

#### æ€»åŸåˆ™

* ä»£ç è´¨é‡ä¼˜å…ˆäºæ–‡ä»¶æ•°é‡
* ä¸ä¸ºå‡‘æ–‡ä»¶è€Œå†™ä»£ç 

#### äº¤ä»˜ç²’åº¦ï¼ˆFeature Sliceï¼‰

* æ¯æ¬¡è¾“å‡º 1 ä¸ªåŠŸèƒ½åˆ‡ç‰‡
* å…è®¸ 3â€“8 ä¸ªæ–‡ä»¶
* è¶…è¿‡å¿…é¡»æ‹† Part 1 / Part 2

#### æ¯ä¸ªåˆ‡ç‰‡å¿…é¡»åŒ…å«

* ä¿®æ”¹ / æ–°å¢æ–‡ä»¶æ¸…å•
* æ¯ä¸ªæ–‡ä»¶å®Œæ•´å†…å®¹
* æœ€å°è¿è¡Œ / éªŒè¯è¯´æ˜

#### ä¸å…è®¸

* æ”¹å·²å†»ç»“çš„ Cloud / Group è®¾è®¡
* å¼•å…¥æ–°äº‘æœåŠ¡ / æ–°è§’è‰²
* Lambda è®¿é—® MySQL
* Backend ç›´æ¥æ“ä½œ Cognito Group

#### æ¨èåˆ‡ç‰‡é¡ºåº

1. Seller Submit æœ€å°é—­ç¯
2. Admin Review æœ€å°é—­ç¯
3. S3 presignï¼ˆå¯é€‰ï¼‰

---

## ğŸ”’ å·²å†»ç»“å†…å®¹æ€»è§ˆï¼ˆç´¢å¼•ï¼‰

ä»¥ä¸‹å†…å®¹ **å·²å†»ç»“**ï¼Œç¦æ­¢ AI / Codex ä¿®æ”¹æˆ–é‡å¤å®ç°ï¼š

* æ¶æ„ä¸åˆ†å±‚ â†’ `docs/ARCHITECTURE.md`
* Cognito ç»“æ„ä¸ Group â†’ [Cognito & Authentication](#cognito--authentication)
* Serverless èµ„æº â†’ [API Gateway & Lambda](#api-gateway--lambda)
* å½“å‰å®Œæˆè¿›åº¦ â†’ [å½“å‰è¿›åº¦é”šç‚¹](#step-3å½“å‰è¿›åº¦é”šç‚¹åŠ¨æ€)

---

## ğŸš§ å°šæœªå†»ç»“å†…å®¹ï¼ˆå…è®¸æ¨è¿›ï¼‰

* Seller Onboarding çš„å®Œæ•´å‰åç«¯åä½œ
* Admin å®¡æ ¸ Seller çš„ UI / API ç»†èŠ‚

ğŸ“Œ æ¨è¿›å‰å¿…é¡»ï¼š

* æ˜ç¡®å†™å…¥æ–‡æ¡£
* æ ‡è®°ä¸ºã€Œå†»ç»“ã€

---

## âœ… ç»™ AI / Codex çš„ä¸€å¥è¯æ€»ç»“

> **README å†³å®šä½ è¯¥è¯»ä»€ä¹ˆï¼Œ
> ARCHITECTURE å†³å®šä½ èƒ½ä¸èƒ½åŠ¨ï¼Œ
> CURRENT_PROGRESS å†³å®šä½ ç°åœ¨è¯¥åšä»€ä¹ˆã€‚**
